<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pooja Booking - Poleramma Temple</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div class="bg-gradient"></div>

<header>
    <div class="logo-container">
        <img src="templeimage/1742626228036 (1).jpg" alt="Logo" class="header-logo">
        <h1>‡∞∂‡±ç‡∞∞‡±Ä ‡∞∂‡±ç‡∞∞‡±Ä ‡∞∂‡±ç‡∞∞‡±Ä ‡∞ö‡±Ä‡∞∞‡∞æ‡∞≤ ‡∞™‡±ã‡∞≤‡±á‡∞∞‡∞Æ‡±ç‡∞Æ ‡∞§‡∞≤‡±ç‡∞≤‡∞ø ‡∞¶‡±á‡∞µ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç</h1>
    </div>
</header>

<main class="booking-container">
    <div class="booking-card animate-fade-in">
        <div class="card-header">
            <h2><i class="fas fa-scroll"></i> ‡∞™‡±Ç‡∞ú‡∞æ ‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç</h2>
            <p>‡∞Æ‡±Ä ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</p>
        </div>
        
        <form id="monthlyForm">
            <div class="input-group">
                <label><i class="fas fa-user"></i> ‡∞™‡±á‡∞∞‡±Å</label>
                <input type="text" id="name" required placeholder="‡∞Æ‡±Ä ‡∞™‡±á‡∞∞‡±Å">
            </div>

            <div class="input-group">
                <label><i class="fas fa-phone"></i> ‡∞´‡±ã‡∞®‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç</label>
                <input type="tel" id="phone" required placeholder="10 ‡∞Ö‡∞Ç‡∞ï‡±Ü‡∞≤ ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç" maxlength="10">
            </div>

            <div class="input-group">
                <label><i class="fas fa-om"></i> ‡∞ó‡±ã‡∞§‡±ç‡∞∞‡∞Ç</label>
                <input type="text" id="gothram" required placeholder="‡∞â‡∞¶‡∞æ: ‡∞µ‡∞æ‡∞∏‡∞ø‡∞∑‡±ç‡∞†">
            </div>

            <div class="input-group">
                <label><i class="fas fa-users"></i> ‡∞ï‡±Å‡∞ü‡±Å‡∞Ç‡∞¨ ‡∞∏‡∞≠‡±ç‡∞Ø‡±Å‡∞≤‡±Å</label>
                <textarea id="family" rows="2" placeholder="‡∞∞‡∞æ‡∞Æ‡±Å, ‡∞∏‡±Ä‡∞§, ‡∞≤‡∞ï‡±ç‡∞∑‡±ç‡∞Æ‡∞ø"></textarea>
            </div>

            <div class="row">
                <div class="col">
                    <label><i class="fas fa-calendar-alt"></i> ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠ ‡∞§‡±á‡∞¶‡±Ä</label>
                    <input type="date" id="startDate" required>
                </div>
                <div class="col">
                    <label><i class="fas fa-calendar-check"></i> ‡∞Æ‡±Å‡∞ó‡∞ø‡∞Ç‡∞™‡±Å ‡∞§‡±á‡∞¶‡±Ä</label>
                    <input type="date" id="endDate" required>
                </div>
            </div>

            <div id="priceSummary" class="price-summary-card">
                <div class="summary-item">
                    <span id="durationText">‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞Ø‡∞ø‡∞® ‡∞®‡±Ü‡∞≤‡∞≤‡±Å: 0</span>
                </div>
                <div class="summary-total">
                    <h3 id="totalCost">‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ0</h3>
                </div>
            </div>

            <button type="submit" class="monthly-btn">
                <span>üõï ‡∞¨‡±Å‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</span>
            </button>
        </form>
    </div>

    <section id="ticketOutput" class="hidden">
        <div class="ticket-card" id="printableTicket">
            <div class="ticket-top-border"></div>
            
            <div class="ticket-header">
                <img src="templeimage/1742626228036 (1).jpg" alt="Logo" class="ticket-logo">
                <h3>‡∞ü‡∞ø‡∞ï‡±Ü‡∞ü‡±ç ‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞£</h3>
                <p class="temple-name">‡∞ö‡±Ä‡∞∞‡∞æ‡∞≤ ‡∞™‡±ã‡∞≤‡±á‡∞∞‡∞Æ‡±ç‡∞Æ ‡∞§‡∞≤‡±ç‡∞≤‡∞ø ‡∞¶‡±á‡∞µ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç</p>
            </div>
            
            <div class="ticket-body">
                <div class="t-row"><span>‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç ID:</span> <b id="t-id"></b></div>
                <div class="t-row"><span>‡∞§‡±á‡∞¶‡±Ä:</span> <span id="t-date"></span></div>
                
                <div class="divider"></div>
                
                <div class="t-row"><span>‡∞≠‡∞ï‡±ç‡∞§‡±Å‡∞®‡∞ø ‡∞™‡±á‡∞∞‡±Å:</span> <span id="t-name"></span></div>
                <div class="t-row"><span>‡∞ó‡±ã‡∞§‡±ç‡∞∞‡∞Ç:</span> <b id="t-gothram"></b></div>
                <div class="t-row"><span>‡∞´‡±ã‡∞®‡±ç:</span> <span id="t-phone"></span></div>
                <div class="t-row"><span>‡∞ï‡∞æ‡∞≤‡∞Ç:</span> <span id="t-period"></span></div>
                
                <div class="price-highlight">
                    <p>‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞™‡±Å</p>
                    <b>‚Çπ<span id="t-total"></span></b>
                </div>

                <div class="qr-section">
                    <div id="qrcode"></div>
                    <p>‡∞µ‡±Ü‡∞∞‡∞ø‡∞´‡∞ø‡∞ï‡±á‡∞∑‡∞®‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞∏‡±ç‡∞ï‡∞æ‡∞®‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</p>
                </div>

                <div class="paid-stamp">VERIFIED</div>
            </div>
            
            <div class="ticket-actions no-print">
                <button onclick="window.print()" class="action-btn btn-print" title="Print"><i class="fas fa-print"></i></button>
                <button onclick="shareWhatsApp()" class="action-btn btn-wa" title="WhatsApp"><i class="fab fa-whatsapp"></i></button>
                <button onclick="shareMessage()" class="action-btn btn-msg" title="Share"><i class="fas fa-share-alt"></i></button>
            </div>
        </div>
    </section>
</main>

<div id="spinner" class="spinner hidden"></div>

<script>
const SCRIPT_URL = "PASTE_YOUR_APPSCRIPT_URL_HERE";
const form = document.getElementById('monthlyForm');
const startInput = document.getElementById('startDate');
const endInput = document.getElementById('endDate');
let bookingData = {};

// Date Logic
startInput.addEventListener('change', function() {
    if (this.value) {
        endInput.min = this.value;
        if (endInput.value && endInput.value < this.value) {
            endInput.value = "";
        }
    }
    updatePrice();
});

endInput.addEventListener('change', updatePrice);

function updatePrice() {
    const startVal = startInput.value;
    const endVal = endInput.value;
    
    if (startVal && endVal) {
        const d1 = new Date(startVal);
        const d2 = new Date(endVal);
        let months = (d2.getFullYear() - d1.getFullYear()) * 12;
        months -= d1.getMonth();
        months += d2.getMonth();
        if (d2.getDate() < d1.getDate()) months--;
        const finalMonths = months <= 0 ? 0 : months;

        document.getElementById('durationText').innerText = `‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞Ø‡∞ø‡∞® ‡∞®‡±Ü‡∞≤‡∞≤‡±Å: ${finalMonths}`;
        document.getElementById('totalCost').innerText = `‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${finalMonths * 100}`;
        return { total: finalMonths * 100, count: finalMonths };
    }
    return { total: 0, count: 0 };
}

// Form Submission
form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const { total, count } = updatePrice();
    if (count <= 0) return Swal.fire("‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï", "‡∞ï‡∞®‡±Ä‡∞∏‡∞Ç ‡∞í‡∞ï ‡∞®‡±Ü‡∞≤ ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡∞ø", "warning");

    document.getElementById('spinner').classList.remove('hidden');
    
    bookingData = {
        bookingID: "POL-" + Date.now().toString().slice(-6),
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        gothram: document.getElementById('gothram').value,
        family: document.getElementById('family').value || 'N/A',
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        totalMonths: count,
        totalAmount: total,
        bookingDate: new Date().toLocaleString('en-IN')
    };

    const formData = new FormData();
    for (let key in bookingData) formData.append(key, bookingData[key]);

    try {
        await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        document.getElementById('spinner').classList.add('hidden');
        
        // Generate QR Code
        const qrContainer = document.getElementById("qrcode");
        qrContainer.innerHTML = "";
        const qrText = `Poleramma Temple\nID: ${bookingData.bookingID}\nName: ${bookingData.name}\nAmount: ‚Çπ${bookingData.totalAmount}\nValid: ${bookingData.startDate} to ${bookingData.endDate}`;
        new QRCode(qrContainer, {
            text: qrText,
            width: 100,
            height: 100,
            colorDark : "#e65100",
            colorLight : "#ffffff"
        });

        Swal.fire({
            title: "‡∞µ‡∞ø‡∞ú‡∞Ø‡∞Ç!",
            text: "‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø",
            icon: "success",
            confirmButtonColor: "#e65100"
        });
        
        document.getElementById('t-id').innerText = bookingData.bookingID;
        document.getElementById('t-date').innerText = bookingData.bookingDate;
        document.getElementById('t-name').innerText = bookingData.name;
        document.getElementById('t-gothram').innerText = bookingData.gothram;
        document.getElementById('t-phone').innerText = bookingData.phone;
        document.getElementById('t-period').innerText = `${bookingData.startDate} ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ${bookingData.endDate}`;
        document.getElementById('t-total').innerText = total;
        
        document.getElementById('ticketOutput').classList.remove('hidden');
        document.getElementById('ticketOutput').scrollIntoView({ behavior: 'smooth' });
    } catch (err) {
        document.getElementById('spinner').classList.add('hidden');
        Swal.fire("Error", "‡∞∏‡∞∞‡±ç‡∞µ‡∞∞‡±ç ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø ‡∞è‡∞∞‡±ç‡∞™‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø", "error");
    }
});

function shareWhatsApp() {
    const text = `*‡∞∂‡±ç‡∞∞‡±Ä ‡∞™‡±ã‡∞≤‡±á‡∞∞‡∞Æ‡±ç‡∞Æ ‡∞Ü‡∞≤‡∞Ø ‡∞ü‡∞ø‡∞ï‡±Ü‡∞ü‡±ç*%0Aüîñ ID: ${bookingData.bookingID}%0Aüë§ ‡∞™‡±á‡∞∞‡±Å: ${bookingData.name}%0AüïâÔ∏è ‡∞ó‡±ã‡∞§‡±ç‡∞∞‡∞Ç: ${bookingData.gothram}%0AüìÖ ‡∞ï‡∞æ‡∞≤‡∞Ç: ${bookingData.startDate} ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ${bookingData.endDate}%0Aüí∞ ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${bookingData.totalAmount}%0A‚úÖ Status: PAID\n\n‡∞µ‡±Ü‡∞∞‡∞ø‡∞´‡∞ø‡∞ï‡±á‡∞∑‡∞®‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞ü‡∞ø‡∞ï‡±Ü‡∞ü‡±ç‚Äå‡∞≤‡±ã‡∞®‡∞ø QR ‡∞ï‡±ã‡∞°‡±ç ‡∞∏‡±ç‡∞ï‡∞æ‡∞®‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.`;
    window.open(`https://wa.me/91${bookingData.phone}?text=${text}`, '_blank');
}

function shareMessage() {
    const text = `Poleramma Temple: ID ${bookingData.bookingID}, ${bookingData.name} (${bookingData.gothram}). From ${bookingData.startDate} to ${bookingData.endDate}. PAID.`;
    if (navigator.share) {
        navigator.share({ title: 'Temple Ticket', text: text });
    } else {
        alert("Copy link to share: " + window.location.href);
    }
}
</script>

<style>
:root {
    --primary: #e65100;
    --secondary: #d84315;
    --accent: #ffb300;
    --bg-light: #fff8e1;
    --glass: rgba(255, 255, 255, 0.95);
}

* { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

body { margin: 0; min-height: 100vh; background-color: var(--bg-light); }

.bg-gradient {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, #ffc107 0%, #ff9800 50%, #e65100 100%);
    z-index: -1;
    opacity: 0.1;
    animation: bgPulse 10s infinite alternate;
}

@keyframes bgPulse { from { opacity: 0.1; } to { opacity: 0.2; } }

header {
    background: var(--glass);
    padding: 20px;
    text-align: center;
    border-bottom: 4px solid var(--primary);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

header h1 { color: var(--primary); font-size: 1.4rem; margin: 10px 0 0; }
.header-logo { width: 70px; height: 70px; border-radius: 50%; border: 3px solid var(--primary); padding: 2px; }

.booking-container { display: flex; flex-direction: column; align-items: center; padding: 30px 20px; gap: 30px; }

.booking-card {
    background: white;
    border-radius: 25px;
    padding: 30px;
    width: 100%;
    max-width: 480px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    border: 1px solid #ffe0b2;
}

.card-header h2 { color: var(--primary); margin: 0; font-size: 1.6rem; }
.card-header p { color: #555; margin-bottom: 25px; }

.input-group { margin-bottom: 18px; text-align: left; }
.input-group label { display: block; font-weight: 700; color: #444; margin-bottom: 8px; font-size: 0.95rem; }
.input-group label i { color: var(--primary); margin-right: 8px; }

input, textarea {
    width: 100%; padding: 14px; border: 2px solid #ffecb3; border-radius: 12px;
    font-size: 1rem; transition: 0.3s; background: #fffdf7;
}

input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 8px rgba(230,81,0,0.2); }

.row { display: flex; gap: 15px; }
.col { flex: 1; }

.price-summary-card {
    background: linear-gradient(to right, #fffde7, #fff9c4);
    border-radius: 15px; padding: 18px; margin: 25px 0;
    border-left: 10px solid var(--primary);
}

.monthly-btn {
    width: 100%; background: linear-gradient(to bottom, var(--secondary), var(--primary));
    color: white; border: none; padding: 16px; border-radius: 50px;
    font-size: 1.2rem; font-weight: 800; cursor: pointer; transition: 0.3s;
    box-shadow: 0 8px 20px rgba(230,81,0,0.3);
}

.monthly-btn:hover { transform: scale(1.02); box-shadow: 0 10px 25px rgba(230,81,0,0.4); }

/* Ticket Styles */
.ticket-card {
    background: #fff; border-radius: 20px; width: 100%; max-width: 420px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.15); position: relative;
    padding: 30px; border: 2px dashed #ffb300;
}

.ticket-top-border {
    position: absolute; top: 0; left: 0; width: 100%; height: 10px;
    background: repeating-linear-gradient(45deg, var(--primary), var(--primary) 15px, var(--accent) 15px, var(--accent) 30px);
}

.ticket-logo { width: 80px; margin-bottom: 10px; border: 2px solid var(--primary); border-radius: 50%; }
.temple-name { font-size: 0.9rem; font-weight: 800; color: var(--primary); margin: 0; }

.divider { height: 2px; border-top: 2px dashed #ffccbc; margin: 20px 0; }

.t-row { display: flex; justify-content: space-between; margin: 10px 0; font-size: 1rem; font-weight: 500; }
.t-row b { color: var(--primary); }

.price-highlight {
    background: #f1f8e9; border: 2px solid #c8e6c9; border-radius: 12px;
    padding: 15px; text-align: center; margin: 20px 0;
}
.price-highlight b { font-size: 1.8rem; color: #2e7d32; }

/* QR Section */
.qr-section {
    display: flex; flex-direction: column; align-items: center; margin: 20px 0;
    padding: 15px; background: #fffef2; border-radius: 15px; border: 1px solid #ffe0b2;
}
#qrcode { margin-bottom: 10px; padding: 5px; background: white; border: 1px solid #eee; }
.qr-section p { font-size: 0.75rem; color: #888; margin: 0; font-weight: bold; }

.paid-stamp {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-20deg);
    font-size: 3.5rem; font-weight: 900; color: rgba(46, 125, 50, 0.08);
    border: 10px double rgba(46, 125, 50, 0.08); padding: 10px; pointer-events: none;
}

.ticket-actions { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
.action-btn {
    width: 55px; height: 55px; border-radius: 50%; border: none; color: white;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: 0.3s; font-size: 1.2rem;
}
.btn-print { background: #546e7a; }
.btn-wa { background: #2e7d32; }
.btn-msg { background: #1565c0; }
.action-btn:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

.hidden { display: none; }
.spinner { position: fixed; top: 50%; left: 50%; width: 60px; height: 60px; border: 6px solid #f3f3f3; border-top: 6px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; z-index: 9999; }

@keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

@media print {
    #qrcode img { display: inline-block !important; }
    .ticket-card { box-shadow: none; border: 2px solid var(--primary); margin: 0 auto; width: 100%; }
    .no-print { display: none !important; }
}
</style>
</body>
</html>
